var gm={},parents={},childrenGameObject={},selectedSprite=void 0,lockedSelection=!1,positions=new Array;camera={x:0,y:0,scale:1,followX:!0,followY:!0,followingTransform:void 0,followPercent:100,follow:function(e,t){t&&(this.followPercent=t),"string"==typeof e&&objects[e]?this.followingTransform=objects[e].position:e.position?this.followingTransform=e.position:null!=e.x&&null!=e.y&&(this.followingTransform=e)},update:function(e){var t=game.renderer.width,i=game.renderer.height;gameContainer.scale.x=camera.scale,gameContainer.scale.y=camera.scale,gameContainer.x=t/2-camera.x*camera.scale,gameContainer.y=i/2-camera.y*camera.scale,e||this.followingTransform&&(this.followX&&camera.followingTransform.getX()-camera.x!=0&&(this.x+=(this.followingTransform.getX()-camera.x)*this.followPercent/100),this.followY&&camera.followingTransform.getY()-camera.y!=0&&(this.y+=(this.followingTransform.getY()-camera.y)*this.followPercent/100))}},gm.position=function(){this.scaleXFunctions={},this.scaleYFunctions={},this.container=new PIXI.Container,this.isGuiElement=!1,this.rightAligned=!1,this.centerAligned=!1,this.drawAtInteger=!1,this.getZorder=function(){var e="1";return this.isGuiElement&&(e="2"),e+this.zOrder.padLeft(10)+this.gameObject.name.value},this.parent="";var n=this;return newObservable(this,"parent",void 0,function(){n.x=n.x,n.y=n.y,n.rotation=n.rotation},function(e,t){if((parents[n.gameObject.name.value]=t)&&(childrenGameObject[t]||(childrenGameObject[t]=new Array),childrenGameObject[t].push(n.gameObject.name.value)),e&&childrenGameObject[e]){var i=childrenGameObject[e].indexOf(n.gameObject.name.value);-1!=i&&childrenGameObject[e].splice(i,1)}n.isGuiElement=n.isGuiElement}),this.childrenGameObject=new Array,this.x=0,this.y=0,this.zOrder=0,this.width=32,this.height=32,this.scaleX=1,this.scaleY=1,this.rotation=0,this.centerx=.5,this.centery=.5,this.worksInEditor=!0,this.dragging=!1,this.prefabName="",this.prePosition=void 0,this.parentContainer=void 0,this.private={dragging:!0,parent:!0,prefabName:!0,prePosition:!0},this.reloadInEditor={isGuiElement:!0},this.isCollidingScreen=function(e,t){for(var i=!1,n=0;n<this.container.children.length;n++)if(null!=this.container.children[n].containsPoint&&(i=!0,this.container.children[n].containsPoint({x:e,y:t})))return!0;return!i&&(e-=camera.x,t-=camera.y,(this.getScreenX()+this.width*(1-this.centerx))*camera.scale>e&&(this.getScreenX()-this.width*this.centerx)*camera.scale<e&&(this.getScreenY()+this.height*(1-this.centery))*camera.scale>t&&(this.getScreenY()-this.height*this.centery)*camera.scale<t)},this.init=function(e){this.centerx=this.centerx,this.centery=this.centery,this.width=this.width,this.height=this.height},this.customDiv={centerMe:function(e){var t=this;addMenu("Zero",function(){t.x=0,t.y=0,socketemit("gameobject",{action:"change",name:t.gameObject.name.value,plugin:"position",newval:{x:t.x,y:t.y}})},"",e,""),addMenu("Center",function(){t.x=game.renderer.width/2,t.y=game.renderer.height/2,socketemit("gameobject",{action:"change",name:t.gameObject.name.value,plugin:"position",newval:{x:t.x,y:t.y}})},"",e,"")}},this.create=function(){null!=this.parent&&""!=this.parent?this.parentContainer=objects[this.parent].position.container:this.isGuiElement?(this.parentContainer=guiContainer,this.private.rightAligned=!1,this.private.centerAligned=!1):(this.parentContainer=gameContainer,this.private.rightAligned=!0,this.private.centerAligned=!0),this.parentContainer.addChild(this.container);var t=this;newObservable(this,"x",void 0,function(){t.isGuiElement&&(t.rightAligned||t.centerAligned)||(t.container.x=t.x,1==t.drawAtInteger?t.container.x=parseInt(t.x):t.container.x=t.x)})(),newObservable(this,"y",void 0,function(){1==t.drawAtInteger?t.container.y=parseInt(t.y):t.container.y=t.y})(),newObservable(this,"scaleX",void 0,function(){for(var e in t.container.scale.x=t.scaleX,t.scaleXFunctions)t.scaleXFunctions[e]()})(),newObservable(this,"scaleY",void 0,function(){for(var e in t.container.scale.y=t.scaleY,t.scaleYFunctions)t.scaleYFunctions[e]()})(),newObservable(this,"width",void 0,function(){for(var e=0;e<t.container.children.length;e++)0==t.container.children[e].children.length&&(t.container.children[e].width=t.width)})(),newObservable(this,"height",void 0,function(){for(var e=0;e<t.container.children.length;e++)0==t.container.children[e].children.length&&(t.container.children[e].height=t.height)})(),newObservable(this,"rotation",void 0,function(){t.container.rotation=t.rotation*Math.PI/180})(),newObservable(this,"zOrder",void 0,function(){t.container.zOrder=parseFloat(t.zOrder),t.parentContainer.children=t.parentContainer.children.sort(function(e,t){return t.zOrder<e.zOrder?1:-1})})(),newObservable(this,"centerx",void 0,function(){for(var e=0;e<t.container.children.length;e++)null!=t.container.children[e].anchor&&(t.container.children[e].anchor.x=t.centerx)})(),newObservable(this,"centery",void 0,function(){for(var e=0;e<t.container.children.length;e++)null!=t.container.children[e].anchor&&(t.container.children[e].anchor.y=t.centery)})(),INEDITOR&&(newObservable(this,"prefabName",void 0,function(){selectedSprite==this.gameObject&&reDrawPanel(selectedSprite)}),this.clickMe=function(){if(0==gameMouseAction&&!lockedSelection&&null==selectedPrefab()){selectedSprite=this.gameObject;var e=goBack(selectedSprite);socketemit("selectgameobject",e)}},this.dragDisabled=function(){return 0!=gameMouseAction||lockedSelection||selectedSprite!=this.gameObject},this.dragStart=function(e,t){var i=goBack(selectedSprite);socketemit("selectgameobject",i)},this.drag=function(e,t){},this.dragStop=function(e,t){var i=goBack(selectedSprite);socketemit("gameobject",{action:"change",name:i.name.value,plugin:"position",newval:{x:i.position.x,y:i.position.y}})},this.graphics=new PIXI.Graphics),this.rightAlignedGUI()},this.dispose=function(){this.parentContainer.removeChild(this.container),INEDITOR&&selectedSprite==this.gameObject&&(this.container.removeChild(this.graphics),delete this.graphics,selectedSprite=void 0,$("#gameproperties").html(""))},this.render=function(){this.rightAlignedGUI(),INEDITOR&&(this.container.removeChild(this.graphics),delete this.graphics,this.graphics=new PIXI.Graphics,selectedSprite==this.gameObject&&DrawBox(0,0,this.width,this.height,0,this.graphics,this.centerx,this.centery,16767232,1,!1,this.container))},this.move=function(){},this.rightAlignedGUI=function(){if(this.isGuiElement&&this.rightAligned){var e=game.renderer.width/(guiContainer.scale.x*this.getScaleX());this.container.x!=this.x+e&&(this.container.x=this.x+e)}if(this.isGuiElement&&this.centerAligned){e=game.renderer.width/(guiContainer.scale.x*this.getScaleX()*2);this.container.x!=this.x+e&&(this.container.x=this.x+e)}},this.update=function(){},this.getScaleX=function(){return this.parent?parseFloat(this.scaleX)*objects[this.parent].position.getScaleX():parseFloat(this.scaleX)},this.getScaleY=function(){return this.parent?parseFloat(this.scaleY)*objects[this.parent].position.getScaleY():parseFloat(this.scaleY)},this.getParentScaleX=function(){return this.parent?objects[this.parent].position.getScaleX():1},this.getParentScaleY=function(){return this.parent?objects[this.parent].position.getScaleY():1},this.getRotation=function(){return this.parent?parseFloat(this.rotation)*Math.PI/180+objects[this.parent].position.getRotation():parseFloat(this.rotation)*Math.PI/180},this.getUnrotationalX=function(){if(this.parent){var e=parseFloat(this.x);objects[this.parent].position.getX();return e+rotationalX}return parseFloat(this.x)},this.getUnrotationalY=function(){if(this.parent){var e=parseFloat(this.y);objects[this.parent].position.getY();return e+rotationalY}return parseFloat(this.y)},this.getX=function(){if(this.parent){var e=parseFloat(this.x)*this.getParentScaleX(),t=objects[this.parent].position.getX(),i=e,n=objects[this.parent].position.getRotation();if(0!=n){var r=parseFloat(this.y),a=Math.sqrt(e*e+r*r),s=Math.atan2(r,e);i=a*Math.cos(s+n)}return t+i}return parseFloat(this.x)},this.getY=function(){if(this.parent){var e=parseFloat(this.y)*this.getParentScaleY(),t=objects[this.parent].position.getY(),i=e,n=objects[this.parent].position.getRotation();if(0!=n){var r=parseFloat(this.x),a=Math.sqrt(r*r+e*e),s=Math.atan2(e,r);i=a*Math.sin(s+n)}return t+i}return parseFloat(this.y)},this.getScreenX=function(){return this.getX()},this.getScreenY=function(){return this.getY()},this};var tags={};function DrawBox(e,t,i,n,r,a,s,o,h,c,l,g,d){c||(c=1);var u={x:e-s*i,y:t-o*n},p={x:e+(1-s)*i,y:t+(1-o)*n},m={x:u.x,y:p.y},f={x:p.x,y:u.y},v={x:e,y:t},x=r;u=rotateAround(u,v,x),m=rotateAround(m,v,x),p=rotateAround(p,v,x),f=rotateAround(f,v,x),null==d&&a.beginFill(16724736,.01),a.lineStyle(2,h,c),a.moveTo(u.x,u.y),a.lineTo(m.x,m.y),a.lineTo(p.x,p.y),a.lineTo(f.x,f.y),a.lineTo(u.x,u.y),a.endFill(),1!=l&&(a.moveTo(v.x-2,v.y+2),a.lineTo(v.x+2,v.y-2),a.moveTo(v.x+2,v.y+2),a.lineTo(v.x-2,v.y-2)),a.lineStyle(0),1!=l&&g.addChild(a)}function DrawCircle(e,t,i,n,r,a,s,o,h,c,l){var g=e,d=t;r.lineStyle(2,o,h),r.drawCircle(e,t,i),1!=l&&(r.moveTo(g-2,d+2),r.lineTo(g+2,d-2),r.moveTo(g+2,d+2),r.lineTo(g-2,d-2)),r.lineStyle(0),c.addChild(r)}function DrawPolygon(e,t,i,n,r,a,s,o,h){if(!(i.length<2)){r.lineStyle(2,a,s);for(var c={x:e,y:t},l=[],g=0;g<i.length;g++)l[g]={x:i[g].x+e,y:i[g].y+t},l[g]=rotateAround(l[g],c,n);r.moveTo(l[l.length-1].x,l[l.length-1].y);for(g=0;g<l.length;g++)r.lineTo(l[g].x,l[g].y);if(o){for(g=0;g<l.length;g++)i[g].c&&r.lineStyle(2,i[g].c,1),r.drawCircle(l[g].x,l[g].y,2),i[g].c&&r.lineStyle(2,a,s);r.moveTo(c.x-2,c.y+2),r.lineTo(c.x+2,c.y-2),r.moveTo(c.x+2,c.y+2),r.lineTo(c.x-2,c.y-2)}r.lineStyle(0),h.addChild(r)}}gm.name=function(){this.value="",this.tagName="";var n=this;return newObservable(this,"tagName",void 0,function(){},function(e,t){if(null!=tags[e]){var i=tags[e].indexOf(n.gameObject);-1!=i&&tags[e].splice(i,1)}null==tags[t]&&(tags[t]=new Array),tags[t].push(n.gameObject)}),this.dispose=function(){var e=this.tagName;if(null!=tags[e]){var t=tags[e].indexOf(n.gameObject);-1!=t&&tags[e].splice(t,1)}},this};