var prefabname=0,dontInitializeThese=["worksInEditor","__isDragging","requires","__initialized"],textList={},componentList={},sceneOrder=[];function GetComponents(e){return componentList[e]}function saveState(e,n){var t={},a=null==n?[]:n.split(",");for(var r in objects){haveAnyParent(r,a)||(t[r]=goBack(objects[r]))}t.___SceneName=currentSceneName,localStorage["gameEngineStates"+e]=JSON.stringify(t)}function haveAnyParent(e,n){for(var t=parentsNameList(e),a=0;a<n.length;a++)for(var r=0;r<t.length;r++)if(t[r].startsWith(n[a]))return!0;return!1}function parentsNameList(e){var n=[];return parents[e]&&(n=parentsNameList(parents[e])),n.push(e),n}function loadState(e,n){resources[e+".auto"]={data:localStorage["gameEngineStates"+e]};currentSceneName;var t=loadScene(e+".auto",n);0!=t&&(currentSceneName=t.___SceneName)}function deleteState(e){delete localStorage["gameEngineStates"+e]}function nextScene(){if(null!=currentSceneName&&currentSceneName.endsWith(".scene")&&null!=SceneOrder&&!(SceneOrder.length<2)){var e=SceneOrder.indexOf(currentSceneName);if(e+1!=SceneOrder.length){var n=SceneOrder[e+1];loadScene(n),currentSceneName=n}}}function loadScene(e,n){var t={},a="";if("currentScene"!=e){if(e&&resources[e]&&(t=JSON.parse(resources[e].data)),null!=n&&!n(t))return!1;a=currentSceneName,e.endsWith(".scene")?currentSceneName=e:t.___SceneName}else{for(var r in objects)t[r]=goBack(objects[r]);"lastSceneName"in this&&(currentSceneName=lastSceneName),t.___SceneName=currentSceneName}for(var r in componentList={},PIXI.utils.TextureCache)textList[r]||PIXI.utils.TextureCache[r].destroy();for(r=0;r<actionFunctionArrayArray.length;r++)actionFunctionArrayArray[r]=[];for(var r in objects)try{removeGameObject(objects,r,!1)}catch(e){}for(var r in t){if("___SceneName"!=r)addGameObjectBase(t[r],!1)}if(constantGameObjects)for(r=0;r<constantGameObjects.length;r++){t=JSON.parse(constantGameObjects[r]);objects[t.name.value]=t}for(var r in objects)try{initializeGameObject(objects[r],!1,!0)}catch(e){}for(var r in objects){warmUpObject(objects[r],!1)}for(var r in sceneChangeFunctions)sceneChangeFunctions[r].fn(a,e);return t}function getByTagName(e){return tags[e]}function getByTagsName(e){for(var n=new Array,t=0;t<e.length;t++){var a=getByTagName(e[t]);n=n.concat(a)}return n}function createGameObject(e,n){var t=addGameObjectBase(e,n);return initializeGameObject(t,n,!1),t}function removeGameObject(e,n,t){for(var a in t&&(INEDITOR=!0),e[n])disposeComponent(e[n],a,t);delete e[n],INEDITOR=!1}function addPrefab(e,n,t,a){try{t||(t=!1);var r=JSON.parse(JSON.stringify(prefabs[e]));if(n)for(var i in n)for(var o in n[i])r[0][i][o]=n[i][o];var c={},s=new Array;for(i=0;i<r.length;i++){prefabname++;var m=getGOName("PrefabGameObject");a&&0==i&&(m=a),s.push(m),c[r[i].name.value]=m,r[i].name.value=m,r[i].position.parent&&c[r[i].position.parent]&&(r[i].position.parent=c[r[i].position.parent]),createGameObject(r[i],t)}return s}catch(e){}}var prefixCounter=0;function getGOName(e){for(var n=prefixCounter,t="";;){if(!((t=e+ ++n)in objects))break}return prefixCounter=n,t}function addComponent(e,n,t,a){addComponentBase(e,n,t,a),!e[n].requires||null!=e[e[n].requires]&&1==e[e[n].requires].__initialized||(addComponent(e,e[n].requires,{},a),a&&componentAdded(e.name.value,e,e[n].requires)),initializeComponent(e,n,a)}function removeComponent(e,n,t){for(var a in e)e[a].requires==n&&(removeComponent(e,a,t),pluginRemoved(e.name.value,a));if(disposeComponent(e,n,t),delete e[n],t&&reDrawPanel(e),componentList[n]){var r=componentList[n].indexOf(e[n]);-1!=r&&componentList[n].splice(r,1)}}function addGameObjectBase(a,t){if(objects[a.name.value])return objects[a.name.value];var e={};for(var n in a)addComponentBase(e,n,a[n],t);return objects[a.name.value]=e,objects[a.name.value].remove=function(){if(childrenGameObject[a.name.value])for(var e in childrenGameObject[a.name.value])try{objects[childrenGameObject[a.name.value][e]].remove()}catch(e){}a.position.parent&&childrenGameObject[a.position.parent]&&childrenGameObject[a.position.parent].splice(childrenGameObject[a.position.parent].indexOf(a.name.value),1),removeGameObject(objects,a.name.value,t)},objects[a.name.value].addComponent=function(e,n){n||(n={}),addComponent(objects[a.name.value],e,n,t)},objects[a.name.value].removeComponent=function(e){removeComponent(objects[a.name.value],e,t)},objects[a.name.value].children=function(){var e=childrenGameObject[a.name.value],n=new Array;if(null!=e)for(var t=0;t<e.length;t++)n.push(objects[e[t]]);return n},objects[a.name.value]}function initializeGameObject(e,n,t){var a=new Array;for(var r in initializeComponent(e,"name",n),initializeComponent(e,"position",n),e)"name"!=r&&"position"!=r&&tryToInitialize(e,r,n,a,t)}function tryToInitialize(e,n,t,a,r){if(-1==a.indexOf(n)){if("requires"in e[n])for(var i=e[n].requires.split(","),o=0;o<i.length;o++)addComponentBase(e,i[o],{},t),tryToInitialize(e,i[o],t,a);initializeComponent(e,n,t,r),a.push(n)}}function disposeComponent(e,n,t){t&&(INEDITOR=!0);var a=actionFunctions[e.name.value];if(null!=a){for(var r=new Array,i=0;i<a.length;i++)if(a[i].component==e[n])try{for(var o=window[a[i].action],c=-1,s=0;s<o.length;s++)o[s]!=a[i].fn&&o[s].fn!=a[i].fn||(c=s);o.splice(c,1),r.push(a[i])}catch(e){}for(i=0;i<r.length;i++)try{a.splice(a.indexOf(r[i]),1)}catch(e){}0==a.length&&delete actionFunctions[e.name.value]}!e[n].dispose||t&&!e[n].worksInEditor||e[n].dispose(),INEDITOR=!1}function addComponentBase(e,n,t,a,r){if(1!=r&&(e[n]=new gm[n],"dontSerialize"in(e[n].gameObject=e)[n]||(e[n].dontSerialize={}),"serializeObject"in e[n]||(e[n].serializeObject={})),t)for(var i in t)i in e[n]&&"object"==typeof e[n][i]&&1!=e[n].serializeObject[i]||1==e[n].dontSerialize[i]||-1!=dontInitializeThese.indexOf(i)||(e[n][i]=t[i])}function warmUpObject(e,n){for(var t in e)!e[t].afterCreate||n&&!e[t].worksInEditor||(n&&(INEDITOR=!0),e[t].afterCreate(),n&&(INEDITOR=!1))}function initializeComponent(e,n,t,a){if(!e[n].__initialized){if(!e[n].create||t&&!e[n].worksInEditor||(t&&(INEDITOR=!0),e[n].create(),t&&(INEDITOR=!1)),1!=a&&(!e[n].afterCreate||t&&!e[n].worksInEditor||(t&&(INEDITOR=!0),e[n].afterCreate(),t&&(INEDITOR=!1))),e[n].__initialized=!0,t&&!e[n].worksInEditor||inspectComponent(e[n]),e[n].reloadInEditor)for(var r in e[n].reloadInEditor)!function(e,n,t,a){newObservable(e[n],t,void 0,function(){a&&(INEDITOR=!0),changing=!0,!e[n].dispose||a&&!e[n].worksInEditor||e[n].dispose(),!e[n].create||a&&!e[n].worksInEditor||e[n].create(),!e[n].afterCreate||a&&!e[n].worksInEditor||e[n].afterCreate(),changing=!1,INEDITOR=!1})}(e,n,r,t);componentList[n]||(componentList[n]=new Array),componentList[n].push(e[n])}}