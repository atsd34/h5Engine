var cutterID=0;gm.Director=function(){this.backs=[],this.canRestart=!1,this.bricks=new Array,this.lights=new Array,this.unusedLights=new Array,this.obstacles=new Array,this.nodes=new Array,this.unusedObstacles=new Array,this.unusedNodes=new Array,this.score=0,this.unusedBricks=new Array,this.patternNo=0,this.currentPattern=[0,0,0,0,0,0,0,0,0,0,0],this.minPos=0,this.maxPos=0,this.hardness=function(){var t=this.score;return t=Math.max(1.2,Math.sqrt(t)/(2*Math.log(t+20)*Math.LOG10E)),parseInt(100*(1-1/t))},this.hardnessRandom=function(){var t=this.hardness(),s=Math.random();return t/2+parseInt(t*s)},this.createBrick=function(t,s){if(null==t&&(t=this.lastBrick().position.x+253),null==s&&(s=this.floorY),this.patternNo<this.currentPattern.length){var e=this.currentPattern[this.patternNo];switch(this.patternNo++,e){case 1:r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t,r.position.y=s-100,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 2:(i=0==this.unusedNodes.length?objects[addPrefab("ropeNode.prefab")]:this.unusedNodes.splice(0,1)[0]).position.x=t-100+200*Math.random(),i.position.y=s-1300+300*Math.random(),this.nodes.push(i);break;case 7:var i;(i=0==this.unusedNodes.length?objects[addPrefab("ropeNode.prefab")]:this.unusedNodes.splice(0,1)[0]).position.x=t-100,i.position.y=s-1200,this.nodes.push(i),r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t,r.position.y=s-100,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 3:r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t,r.position.y=s-450,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 4:r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t,r.position.y=s-500,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 5:r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t,r.position.y=s,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 6:r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t+128,r.position.y=s,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 8:r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab")[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t,r.position.y=s,r.cutter.horizantalMove=!1,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.id=cutterID++;break;case 9:var r;r=0==this.unusedObstacles.length?objects[addPrefab("Cutter.prefab",{position:{x:t+128,y:s},cutter:{horizantalMove:!0}})[0]]:this.unusedObstacles.splice(0,1)[0],this.obstacles.push(r),r.position.x=t+128,r.position.y=s,r.cutter.startX=r.position.x,r.cutter.startY=r.position.y,r.cutter.horizantalMove=!0,r.cutter.id=cutterID++}}else{if(0<this.score){var o=this.hardnessRandom();this.currentPattern=o<5?[0,0,1,0]:o<10?[0,0,1,2,1]:o<15?[0,0,1,7,1,1]:o<25?[0,0,1,1,7,1,1]:o<35?[0,0,4,1,7,1,1]:o<40?[0,0,1,1,2,1]:o<45?[0,0,0,1,1,2,0,5,0]:o<50?[0,0,1,9,2,0,1,0]:o<55?[0,0,1,2,1,0,3,0]:o<59?[0,0,4,0,1,7,1,0,4,4,0]:o<63?[0,0,1,2,1,1,0,6,1,0,3,0,0]:o<67?[0,0,4,1,7,1,1,4,0]:o<71?[0,0,7,4,4,1,0,1,7,0,6,1,0,3,0,1,0]:o<74?[0,0,7,0,4,1,0,1,7,0,6,1,0,3,0,1]:o<77?[0,0,1,4,1,7,1,4,0]:o<80?[0,0,0,0,7,9,0,0,0]:o<82?[0,0,0,0,9,2,9,0,0,0]:o<85?[0,0,0,0,9,7,9,0,0,0]:o<88?[0,0,0,0,9,2,9,1,0,0]:o<91?[0,0,0,1,9,2,9,1,0,0]:o<94?[0,0,0,1,4,1,0,7,0,1,4,1]:[0,0,7,9,0,0,0,7,0,0,0,1,1,7,4,4,1,7,1,1,4,4,1,7,0,0,0,7,4,4,1,0,1,7,0,6,1,0,3,0,1,0]}else this.currentPattern=[4,0,1,0,0,0,1,7,1,0,0];var a=void(this.patternNo=0);0==this.unusedLights.length?a=objects[addPrefab("Vial.prefab",{position:{x:t,y:s-80}})[0]]:((a=this.unusedLights.splice(0,1)[0]).position.x=t,a.sprite.path="light.png"),this.lights.push(a)}var n;if(0==this.unusedBricks.length){var c="FLOOR\\f4.png";switch(parseInt(5*Math.random())){case 0:c="FLOOR\\f1.png";break;case 1:c="FLOOR\\f2.png";break;case 2:c="FLOOR\\f3.png"}n=objects[addPrefab("Brick.prefab",{sprite:{path:c}})]}else n=this.unusedBricks.splice(0,1)[0];n.position.x=t,n.position.y=s,this.bricks.push(n)},this.lastBrick=function(){return this.bricks[this.bricks.length-1]},this.firstBrick=function(){return this.bricks[0]}},gm.Director.prototype.create=function(){null==localStorage.highestEscapeEvilCorpScore&&(localStorage.highestEscapeEvilCorpScore=0),objects.HighScore.text.text="Best :"+localStorage.highestEscapeEvilCorpScore;for(var t=0;t<5;t++){var s=objects[addPrefab("back.prefab",{sprite:{path:"factory"+t+".png"},tint:{tint:"0xffffff"}})[0]];s.position.x=(s.position.width-1)*t-2e3,this.backs.push(s)}pausedUpdate=!0,this.floorY=600,this.createBrick(-2e3);for(t=0;t<40;t++)this.update()},gm.Director.prototype.render=function(t){camera.scale=game.view.height/1550,guiContainer.scale.x=game.view.height/1350,guiContainer.scale.y=game.view.height/1350},gm.Director.prototype.update=function(t){for(var s=0;s<this.backs.length;s++){var e=s-1;if(-1==e&&(e=this.backs.length-1),this.backs[s].position.x+this.backs[s].position.width/2<objects.Main.position.x-3e3){this.backs[s].position.x=this.backs[e].position.x+this.backs[e].position.width-1;var i=255-Math.min(180,parseInt(this.score/3));this.backs[s].tint.tint="0x"+(16711680+256*i+i).toString(16)}}if(objects.Main&&objects.Main.position){camera.x<objects.Main.position.x&&(camera.x=objects.Main.position.x);var r=parseInt(objects.Main.position.x/100);this.score=Math.max(r,this.score),this.score>localStorage.highestEscapeEvilCorpScore&&(objects.HighScore.text.text="Best :"+this.score);var o="Score:"+this.score;o!=objects.GUI.text.text&&(objects.GUI.text.text=o);var a=this.firstBrick();for(s=0;s<this.lights.length;s++)if(this.lights[s].position.x<objects.Main.position.x-3e3){var n=this.lights.splice(s,1)[0];this.unusedLights.push(n);break}var c=objects.Main.position.x-2200,h=objects.Main.position.x+2200;1<this.bricks.length&&a.position.x<c&&this.unusedBricks.push(this.bricks.splice(0,1)[0]);var u=this.obstacles[0],p=this.nodes[0];null!=u&&u.position.x<c&&this.unusedObstacles.push(this.obstacles.splice(0,1)[0]),null!=p&&p.position.x<c&&this.unusedNodes.push(this.nodes.splice(0,1)[0]),(n=this.lastBrick()).position.x<h&&this.createBrick()}};