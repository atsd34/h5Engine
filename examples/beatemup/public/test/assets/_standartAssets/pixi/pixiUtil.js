function TilerDiv(t){var e=this,i=addMenu("Edit",function(){e.Editing?(lockedSelection=!1,$(".btnResetTile").removeClass("btn-danger").html("Edit"),e.Editing=!1,e.currentTile={},$("canvas").off("click",e.onclick),void 0!=e.preRotation&&(e.gameObject.position.rotation=e.preRotation)):(camera.scale=1,lockedSelection=!0,e.Editing=!0,e.preRotation=e.gameObject.position.rotation,e.gameObject.position.rotation=0,$(".btnResetTile").addClass("btn-danger").html("Stop"),e.onclick=function(t){var i=Math.ceil(e.texture.width/e.tileWidth),a=Math.ceil(e.texture.height/e.tileHeight),s=Math.floor(t.offsetX/e.tileWidth),n=Math.floor(t.offsetY/e.tileHeight);s<i&&n<a&&(e.currentTile={x:s,y:n}),void 0!=e.currentTile.x&&(s=Math.floor((t.offsetX-e.gameObject.position.getScreenX()-camera.x)/e.tileWidth),n=Math.floor((t.offsetY-e.gameObject.position.getScreenY()-camera.y)/e.tileHeight),i=Math.ceil(e.gameObject.position.width/e.tileWidth),a=Math.ceil(e.gameObject.position.height/e.tileHeight),s<i&&n<a&&s>-1&&n>-1&&(void 0==e.tilesNum[s]&&(e.tilesNum[s]=[]),e.tilesNum[s][n]=e.currentTile,e.reloadME++,socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{tilesNum:e.tilesNum}})))},$("canvas").on("click",e.onclick))},"",t,"btnResetTile");1==e.Editing&&(camera.scale=1,lockedSelection=!0,$(i).addClass("btn-danger").html("Stop"))}gm.sprite=function(){if(this.currentAnim={frame:0,loop:!0,func:function(){}},this.path="",this.AnimationSpeed=.5,this.isTileMap=!1,this.spriteSheet=!1,this.randomTiled=!1,this.sheetTileWidth=32,this.sheetTileHeight=32,this.sheetTileSpacing=0,this.tileWidth=32,this.tileHeight=32,this.animations=[],this.animationData=[],this.texture={},this.currentTile={},this.tempPallete=void 0,this.private={sheetTileSpacing:!0,tileWidth:!0,tileHeight:!0,reloadME:!0,sheetTileWidth:!0,sheetTileHeight:!0},this.reloadInEditor={randomTiled:!0,path:!0,isTileMap:!0,tileWidth:!0,tileHeight:!0,reloadME:!0,spriteSheet:!0,sheetTileWidth:!0,sheetTileHeight:!0},this.tiles=[],this.tilesNum=[],this.randomTypes=[],this.dontSerialize={Editing:!0,reloadME:!0},this.serializeObject={tilesNum:!0,animationData:!0,randomTypes:!0},this.reloadME=0,$this=this,newObservable(this,"AnimationSpeed",void 0,function(t,e){try{e.sprite.animationSpeed=parseFloat(e.AnimationSpeed)}catch(t){}}),this.worksInEditor=!0,this.comboBoxes={},"assetList"in window){this.comboBoxes.path=new Array;for(var t=0;t<assetList.length;t++)0==assetList[t].isFolder&&(isImage(assetList[t].name)||assetList[t].name.endsWith(".anim"))&&this.comboBoxes.path.push({text:assetList[t].name,value:assetList[t].name})}this.loopAnim=function(t){var e=t;if("string"==typeof e)for(var i=0;i<this.animationData.length;i++)this.animationData[i].name==e&&(e=i);else t=this.animationData[e].name;this.currentAnim={name:t,frame:e,loop:!0,func:function(){}},this.reloadME++},this.playOnceAnim=function(t,e){var i=t;if("string"==typeof i)for(var a=0;a<this.animationData.length;a++)this.animationData[a].name==i&&(i=a);else t=this.animationData[i].name;i!=this.currentAnim.frame?(this.currentAnim={name:t,frame:i,loop:!1,func:void 0!=e?e:function(){}},this.reloadME++):(this.currentAnim={name:t,frame:i,loop:!1,func:void 0!=e?e:function(){}},this.sprite.loop=this.currentAnim.loop,this.sprite.onComplete=this.currentAnim.func,this.sprite.gotoAndPlay(0))},this.create=function(){try{if(this.private.sheetTileSpacing=!0,this.randomTiled){if(this.spriteSheet&&(this.spriteSheet=!1),this.private.sheetTileWidth=!1,this.private.sheetTileHeight=!1,this.private.sheetTileSpacing=!1,this.randomTypes.length>0){for(var t=resources[this.path].texture,e=PIXI.RenderTexture.create(this.gameObject.position.width,this.gameObject.position.height),i=t.width,a=t.height,s=parseInt(i/this.sheetTileWidth),n=(parseInt(a/this.sheetTileHeight),Math.ceil(this.gameObject.position.width/this.sheetTileWidth)),h=Math.ceil(this.gameObject.position.height/this.sheetTileHeight),o=0;o<n;o++)for(M=0;M<h;M++){for(var r=new Array,p=new Array,l=0;l<this.randomTypes.length;l++){var c=this.randomTypes[l];if((-1==c.minX||o<=c.minX)&&(-1==c.maxX||o>=c.maxX)&&(-1==c.minY||M<=c.minY)&&(-1==c.maxY||M>=c.maxY)){for(var m=c.num.toString().split(","),d=0;d<m.length;d++)r.push(parseInt(m[d]));p.push(c)}}var g=Math.floor(Math.random()*r.length),u=p[g],T=r[g],v=0;try{if(u.shiftData){var f=JSON.parse(u.shiftData);for(var w in f){var b=w.replace("a","").split("_");(!b[0]||o>=parseInt(b[0]))&&(!b[1]||o<=parseInt(b[1]))&&(void 0!=f[w].h&&(v=parseInt(f[w].h)),(!f[w].lim||parseInt(f[w].lim)>=M)&&((b[0]&&o==parseInt(b[0])&&f[w].l||0==o&&f[w].l)&&(T=f[w].l),(b[1]&&o==parseInt(b[1])&&f[w].r||o==n-1&&f[w].r)&&(T=f[w].r)))}}}catch(t){}var y=T-(j=parseInt(T/s))*s,I=new PIXI.Texture(t,new PIXI.Rectangle(y*this.sheetTileWidth,j*this.sheetTileHeight,this.sheetTileWidth,this.sheetTileHeight)),S=new PIXI.Sprite(I);new PIXI.Transform;S.x=o*(this.sheetTileWidth-this.sheetTileSpacing)-this.sheetTileSpacing,S.y=M*(this.sheetTileHeight-this.sheetTileSpacing)-this.sheetTileSpacing-v,game.renderer.render(S,e,!1)}this.sprite=new PIXI.Sprite(e)}INEDITOR&&(this.customDiv={types:function(t){for(var e=this,i=$("<table style='width:100%' />").appendTo(t),a=0;a<this.randomTypes.length;a++){var s=this.randomTypes[a],n=$("<tr />").appendTo(i),h=$("<td style='width:40%' />").appendTo(n),o=$("<td colspan='2' />").appendTo(n),r=$("<td style='width:16px' />").appendTo(n);h.append("<b>"+a+" Sprite Number:</b>");var p=$("<input style='width:100%' />").appendTo(o);p.val(s.num),p.attr("whichAnim",a),p.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes[t].num=$(this).val(),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++});var l=$('<img src="img/close.png" />').appendTo(r);l.attr("whichAnim",a),l.on("click",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes.splice(t,1),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++});var n=$("<tr />").appendTo(i),h=$("<td />").appendTo(n),o=$("<td style='width:30%' />").appendTo(n),r=$("<td colspan='2' />").appendTo(n);h.append(a+" X Range:"),(p=$("<input  style='width:100%'/>").appendTo(o)).val(this.randomTypes[a].minX),p.attr("whichAnim",a),p.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes[t].minX=parseInt($(this).val()),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++}),(p=$("<input  style='width:100%'/>").appendTo(r)).val(this.randomTypes[a].maxX),p.attr("whichAnim",a),p.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes[t].maxX=parseInt($(this).val()),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++});var n=$("<tr />").appendTo(i),h=$("<td />").appendTo(n),o=$("<td style='width:30%' />").appendTo(n),r=$("<td colspan='2' />").appendTo(n);h.append(a+" Y Range:"),(p=$("<input  style='width:100%'/>").appendTo(o)).val(this.randomTypes[a].minY),p.attr("whichAnim",a),p.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes[t].minY=parseInt($(this).val()),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++}),(p=$("<input  style='width:100%'/>").appendTo(r)).val(this.randomTypes[a].maxY),p.attr("whichAnim",a),p.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes[t].maxY=parseInt($(this).val()),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++});var n=$("<tr />").appendTo(i),h=$("<td />").appendTo(n),o=$("<td colspan='3' />").appendTo(n);h.append(a+" Shift Data"),(p=$("<input  style='width:100%'/>").appendTo(o)).val(this.randomTypes[a].shiftData),p.attr("whichAnim",a),p.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.randomTypes[t].shiftData=$(this).val(),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++})}addMenu("Add New Random Tile",function(){e.randomTypes.push({num:0,minX:-1,maxX:-1,minY:-1,maxY:-1,shiftData:""}),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{randomTypes:e.randomTypes}}),e.reloadME++},"",t,"btnAddAnimation")}})}else if(this.spriteSheet){this.private.sheetTileWidth=!1,this.private.sheetTileHeight=!1,this.animations=[];var i=(t=resources[this.path].texture).width,a=t.height,s=parseInt(i/this.sheetTileWidth);parseInt(a/this.sheetTileHeight);0==this.animationData.length&&(this.animationData=[{seq:[0],FPS:6,name:"default"}]);for(o=0;o<this.animationData.length;o++){var O=this.animationData[o];this.animations[o]=[];for(M=0;M<O.seq.length;M++){var j=parseInt(O.seq[M]/s),y=O.seq[M]-j*s;this.animations[o].push(new PIXI.Texture(t,new PIXI.Rectangle(y*this.sheetTileWidth,j*this.sheetTileHeight,this.sheetTileWidth,this.sheetTileHeight)))}}this.sprite=new PIXI.extras.AnimatedSprite(this.animations[this.currentAnim.frame]),this.sprite.loop=this.currentAnim.loop,this.sprite.onComplete=this.currentAnim.func,changing&&INEDITOR&&(this.gameObject.position.width=this.sprite.width,this.gameObject.position.height=this.sprite.height,socketemit("gameobject",{action:"change",name:this.gameObject.name.value,plugin:"position",newval:{width:this.gameObject.position.width,height:this.gameObject.position.height}})),this.currentAnim.name=this.animationData[this.currentAnim.frame].name,this.sprite.animationSpeed=this.animationData[this.currentAnim.frame].FPS/60,INEDITOR?this.customDiv={animationSequences:function(t){for(var e=this,i=$("<table style='width:100%' />").appendTo(t),a=0;a<this.animationData.length;a++){var s=$("<tr />").appendTo(i),n=$("<td style='width:40%' />").appendTo(s),h=$("<td  />").appendTo(s),o=$("<td style='width:16px' />").appendTo(s);n.append("<b>"+a+" animation Name:</b>");var r=$("<input style='width:100%' />").appendTo(h);r.val(this.animationData[a].name),r.attr("whichAnim",a),r.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.animationData[t].name=$(this).val(),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{animationData:e.animationData}}),e.reloadME++});var p=$('<img src="img/close.png" />').appendTo(o);p.attr("whichAnim",a),p.on("click",function(){var t=parseInt($(this).attr("whichAnim"));e.animationData.splice(t,1),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{animationData:e.animationData}}),e.reloadME++});var s=$("<tr />").appendTo(i),n=$("<td />").appendTo(s),h=$("<td colspan='2' />").appendTo(s);n.append(a+" animation FPS:"),(r=$("<input  style='width:100%'/>").appendTo(h)).val(this.animationData[a].FPS),r.attr("whichAnim",a),r.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.animationData[t].FPS=parseInt($(this).val()),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{animationData:e.animationData}}),e.reloadME++});var s=$("<tr />").appendTo(i),n=$("<td/>").appendTo(s),h=$("<td colspan='2' />").appendTo(s);n.append(a+" animation sequence:"),r=$("<input style='width:100%' />").appendTo(h);var l=JSON.stringify(this.animationData[a].seq);r.val(l.substr(1,l.length-2)),r.attr("whichAnim",a),r.on("change",function(){var t=parseInt($(this).attr("whichAnim"));e.animationData[t].seq=JSON.parse("["+$(this).val()+"]"),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{animationData:e.animationData}}),e.reloadME++})}addMenu("Add New Animation",function(){e.animationData.push({seq:[0],FPS:6,name:""}),socketemit("gameobject",{action:"change",name:e.gameObject.name.value,plugin:"sprite",newval:{animationData:e.animationData}}),e.reloadME++},"",t,"btnAddAnimation")}}:this.sprite.play()}else if(this.private.sheetTileWidth=!0,this.private.sheetTileHeight=!0,this.isTileMap){this.gameObject.position.centerx=0,this.gameObject.position.centery=0,this.customDiv={tiler:TilerDiv},this.private={sheetTileSpacing:!0,AnimationSpeed:!0,Editing:!0,reloadME:!0,sheetTileWidth:!0,sheetTileHeight:!0},this.texture=resources[this.path].texture;for(var x=Math.ceil(this.texture.width/this.tileWidth),A=Math.ceil(this.texture.height/this.tileHeight),o=0;o<x;o++){this.tiles[o]=[];for(M=0;M<A;M++){var D=this.tileWidth;(y=o*this.tileWidth)+D>this.texture.width&&(D=this.texture.width-y);var W=this.tileHeight;(j=M*this.tileHeight)+W>this.texture.height&&(W=this.texture.height-j),this.tiles[o][M]=new PIXI.Texture(this.texture,new PIXI.Rectangle(y,j,D,W))}}this.sprite=new PIXI.Container;for(o=0;o<this.tilesNum.length;o++)for(var M=0;M<this.tilesNum[o].length;M++){var E=this.tilesNum[o][M];if(void 0!=E&&void 0!=E.x){var k=this.tiles[E.x][E.y];(S=new PIXI.Sprite(k)).x=o*this.tileWidth,S.y=M*this.tileHeight,this.sprite.addChild(S)}}}else{if(this.customDiv={},this.private={sheetTileSpacing:!0,tileWidth:!0,tileHeight:!0,Editing:!0,reloadME:!0,sheetTileWidth:!0,sheetTileHeight:!0},this.path.endsWith("anim")){var P=new Array,X=JSON.parse(resources[this.path].data);for(var o in X)P.push(resources[X[o]].texture);this.sprite=new PIXI.extras.AnimatedSprite(P),this.sprite.animationSpeed=parseFloat(this.AnimationSpeed),INEDITOR||this.sprite.play()}else this.sprite=new PIXI.Sprite(resources[this.path].texture);changing&&INEDITOR&&(this.gameObject.position.width=this.sprite.width,this.gameObject.position.height=this.sprite.height,socketemit("gameobject",{action:"change",name:this.gameObject.name.value,plugin:"position",newval:{width:this.gameObject.position.width,height:this.gameObject.position.height}}))}}catch(t){this.sprite={anchor:{}}}INEDITOR&&selectedSprite==this.gameObject&&reDrawPanel1(this.gameObject);try{this.gameObject.position.container.addChild(this.sprite)}catch(t){}this.gameObject.position.init()},this.update=function(){if(INEDITOR&&1==this.isTileMap){if(void 0!=this.tempPallete){try{for(;this.tempPallete.children.length>0;)this.tempPallete.removeChild(this.tempPallete.children[0])}catch(t){}guiContainer.removeChild(this.tempPallete),this.tempPallete=void 0}if(selectedSprite==this.gameObject&&1==this.Editing){this.tempPallete=new PIXI.Container;for(var t=Math.ceil(this.texture.width/this.tileWidth),e=Math.ceil(this.texture.height/this.tileHeight),i=0;i<t;i++)for(var a=0;a<e;a++){var s=this.tiles[i][a],n=new PIXI.Sprite(s);n.x=i*(this.tileWidth+1)-camera.x,n.y=a*(this.tileHeight+1)-camera.y,this.tempPallete.addChild(n)}this.graphics=new PIXI.Graphics,this.graphics.lineStyle(1,16767232,1);for(var h=Math.ceil(this.gameObject.position.width/this.tileWidth),o=Math.ceil(this.gameObject.position.height/this.tileHeight),i=1;i<h;i++)this.graphics.moveTo(i*this.tileWidth+this.gameObject.position.getScreenX(),this.gameObject.position.getScreenY()),this.graphics.lineTo(i*this.tileWidth+this.gameObject.position.getScreenX(),this.gameObject.position.height+this.gameObject.position.getScreenY());for(i=1;i<o;i++)this.graphics.moveTo(this.gameObject.position.getScreenX(),i*this.tileHeight+this.gameObject.position.getScreenY()),this.graphics.lineTo(this.gameObject.position.width+this.gameObject.position.getScreenX(),i*this.tileHeight+this.gameObject.position.getScreenY());this.graphics.lineStyle(0),void 0!=this.currentTile.x&&DrawBox(this.currentTile.x*(this.tileWidth+1)-camera.x,this.currentTile.y*(this.tileHeight+1)-camera.y,this.tileWidth,this.tileHeight,0,this.graphics,0,0,16711680,1,!0,this.gameObject.position.container),this.tempPallete.addChild(this.graphics),guiContainer.addChild(this.tempPallete)}}},this.dispose=function(){try{this.gameObject.position.container.removeChild(this.sprite)}catch(t){}try{this.sprite.destroy&&this.sprite.destroy()}catch(t){}delete this.sprite}},gm.tint=function(){return this.tint="0xffffff",this.worksInEditor=!0,newObservable,this.create=function(){var t=this;newObservable(this,"tint",void 0,function(e,i){t.gameObject.sprite.sprite.tint=t.tint})()},this.dispose=function(){this.gameObject.sprite&&this.gameObject.sprite.sprite&&this.gameObject.sprite.sprite.tint&&(this.gameObject.sprite.sprite.tint="0xffffff")},this},gm.text=function(){this.text="",this.fontSize="16",this.fontFamily="Arial",this.fontStyle="italic",this.fontWeight="bold",this.fill="['#ffffff']",this.stroke="#000000",this.strokeThickness=2,this.dropShadows=!0,this.ShadowColor="#000000",this.dropShadowBlur=4,this.dropShadowAngle=45,this.dropShadowDistance=6,this.wordWrap=!0,this.wordWrapWidth=440,this.private={},this.worksInEditor=!0,this.reloadInEditor={fontSize:!0,fontFamily:!0,fontStyle:!0,fontWeight:!0,fill:!0,stroke:!0,strokeThickness:!0,dropShadows:!0,ShadowColor:!0,dropShadowBlur:!0,dropShadowAngle:!0,dropShadowDistance:!0,wordWrap:!0,wordWrapWidth:!0},this.create=function(){try{var t=["#ffffff"];try{t=JSON.parse(this.fill.replace(/\'/g,'"'))}catch(t){}var e=new PIXI.TextStyle({fontFamily:this.fontFamily,fontSize:parseInt(this.fontSize),fontStyle:this.fontStyle,fontWeight:this.fontWeight,fill:t,stroke:this.stroke,strokeThickness:parseInt(this.strokeThickness),dropShadow:this.dropShadows,dropShadowColor:this.dropShadowColor,dropShadowBlur:this.dropShadowBlur,dropShadowAngle:parseFloat(this.dropShadowAngle)*Math.PI/180,dropShadowDistance:parseInt(this.dropShadowDistance),wordWrap:this.wordWrap,wordWrapWidth:parseInt(this.wordWrapWidth)});this.sprite=new PIXI.Text(this.text,e);var i=this;newObservable(this,"text",void 0,function(t,e){i.sprite.setText(t),i.gameObject.position.width=i.sprite.width,i.gameObject.position.height=i.sprite.height})}catch(t){}changing&&(this.gameObject.position.width=this.sprite.width,this.gameObject.position.height=this.sprite.height,INEDITOR&&socketemit("gameobject",{action:"change",name:this.gameObject.name.value,plugin:"position",newval:{width:this.gameObject.position.width,height:this.gameObject.position.height}})),INEDITOR&&selectedSprite==this.gameObject&&reDrawPanel1(this.gameObject);try{this.gameObject.position.container.addChild(this.sprite)}catch(t){}this.gameObject.position.init("text")},this.dispose=function(){try{this.gameObject.position.container.removeChild(this.sprite)}catch(t){}this.sprite.destroy&&this.sprite.destroy(),delete this.sprite}};