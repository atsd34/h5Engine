function inspectComponent(e,n){for(var t=0;t<inspectFunctions.length;t++)inspectFunctions[t](e,n);if("clickMe"in e){o=function(n,t){e.gameObject.position.isCollidingScreen(t.offsetX,t.offsetY)&&e.clickMe(n,t)};clickFunctions.push(o),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"clickFunctions",fn:o})}if("sceneChange"in e){o=function(n,t){return e.sceneChange(n,t)};sceneChangeFunctions.push({fn:o,component:e})}if("mouseDownOnMe"in e){o=function(n,t){if(e.gameObject.position.isCollidingScreen(t.offsetX,t.offsetY))return e.mouseDownOnMe(n,t)};mousedownFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousedownFunctions",fn:o})}if("mouseUpOnMe"in e){o=function(n,t){if(e.gameObject.position.isCollidingScreen(t.offsetX,t.offsetY))return e.mouseUpOnMe(n,t)};mouseupFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mouseupFunctions",fn:o})}if("mouseMoveOnMe"in e){o=function(n,t){if(e.gameObject.position.isCollidingScreen(t.offsetX,t.offsetY))return e.mouseMoveOnMe(n,t)};mousemoveFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousemoveFunctions",fn:o})}if("click"in e){o=function(n,t){return e.click(n,t)};clickFunctions.push(o),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"clickFunctions",fn:o})}if("mousewheel"in e){o=function(n,t){return e.mousewheel(n,t)};mousewheelFunctions.push(o),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousewheelFunctions",fn:o})}if("mouseDown"in e){o=function(n,t){return e.mouseDown(n,t)};mousedownFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousedownFunctions",fn:o})}if("keyDown"in e){o=function(n,t){return e.keyDown(n,t)};keydownFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"keydownFunctions",fn:o})}if("keyPress"in e){o=function(n,t){return e.keyPress(n,t)};keyPressFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"keyPressFunctions",fn:o})}if("keyUp"in e){o=function(n,t){return e.keyUp(n,t)};keyupFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"keyupFunctions",fn:o})}if("mouseUp"in e){o=function(n,t){return e.mouseUp(n,t)};mouseupFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mouseupFunctions",fn:o})}if("mouseMove"in e){var o=function(n,t){return e.mouseMove(n,t)};mousemoveFunctions.push({fn:o,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousemoveFunctions",fn:o})}if("dragStart"in e||"dragStop"in e||"drag"in e){var a=function(n,t){if(e.__isDragging=!1,(void 0==e.dragDisabled||0==e.dragDisabled())&&e.gameObject.position.isCollidingScreen(t.offsetX,t.offsetY)&&(e.__isDragging=!0,e.__offset={x:t.offsetX,y:t.offsetY},e.dragStart))return e.dragStart(n,t)},i=function(n,t){if((void 0==e.dragDisabled||0==e.dragDisabled())&&1==e.__isDragging){var o=0;if(e.gameObject.position.parent&&objects[e.gameObject.position.parent]&&(o=objects[e.gameObject.position.parent].position.getRotation()),0!=o){var a=(t.offsetX-e.__offset.x)/camera.scale,i=(t.offsetY-e.__offset.y)/camera.scale,c=Math.sqrt(a*a+i*i),s=Math.atan2(i,a),u=c*Math.sin(s-o),r=c*Math.cos(s-o);e.gameObject.position.x=r+parseFloat(e.gameObject.position.x),e.gameObject.position.y=u+parseFloat(e.gameObject.position.y)}else e.gameObject.position.x=(t.offsetX-e.__offset.x)/camera.scale+parseFloat(e.gameObject.position.x),e.gameObject.position.y=(t.offsetY-e.__offset.y)/camera.scale+parseFloat(e.gameObject.position.y);if(e.__offset={x:t.offsetX,y:t.offsetY},e.drag)return e.drag(n,t)}},c=function(n,t){if(e.__isDragging&&(void 0==e.dragDisabled||0==e.dragDisabled())&&(i(n,t),e.__isDragging=!1,e.dragStop))return e.dragStop(n,t)};mousedownFunctions.push({fn:a,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),mouseupFunctions.push({fn:c,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),mousemoveFunctions.push({fn:i,c:void 0==e.priorty?-1:e.priorty,n:e.gameObject.name.value}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousedownFunctions",fn:a}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mousemoveFunctions",fn:i}),void 0==actionFunctions[e.gameObject.name.value]&&(actionFunctions[e.gameObject.name.value]=new Array),actionFunctions[e.gameObject.name.value].push({component:e,action:"mouseupFunctions",fn:c})}mousedownFunctions=mousedownFunctions.sort(function(e,n){try{return e.c<n.c?1:e.c>n.c?-1:0}catch(e){return 0}}),mouseupFunctions=mouseupFunctions.sort(function(e,n){try{return e.c<n.c?1:e.c>n.c?-1:0}catch(e){return 0}}),mousemoveFunctions=mousemoveFunctions.sort(function(e,n){try{return e.c<n.c?1:e.c>n.c?-1:0}catch(e){return 0}})}function initCanvasActions(){$("canvas").on("click",function(e){if(clickFunctions.length>0){var n=game.renderer.width/2,t=game.renderer.height/2;switch(clicked=!0,mouse.screenX=e.offsetX,mouse.screenY=e.offsetY,e.button){case 0:mouse.left=!0;break;case 1:mouse.middle=!0;break;case 2:mouse.right=!0}mouse.x=(mouse.screenX-n)/camera.scale+camera.x,mouse.y=(mouse.screenY-t)/camera.scale+camera.y;for(var o=0;o<clickFunctions.length;o++)clickFunctions[o](mouse,e)}}),$("canvas").on("contextmenu",function(e){e.preventDefault()}),$("canvas").on("mousewheel DOMMouseScroll",function(e){if(mousewheelFunctions.length>0)for(var n=0;n<mousewheelFunctions.length;n++)mousewheelFunctions[n](e.originalEvent.wheelDelta,e)}),$("canvas").on("mousedown touchstart",function(e){if("touchstart"==e.type&&e.touches&&((e=e.touches[0]).offsetX=e.pageX-e.target.offsetLeft,e.offsetY=e.pageY-e.target.offsetTop),mousedownFunctions.length>0){var n=game.renderer.width/2,t=game.renderer.height/2;switch(clicked=!0,mouse.screenX=e.offsetX,mouse.screenY=e.offsetY,e.button){case 0:mouse.left=!0;break;case 1:mouse.middle=!0;break;case 2:mouse.right=!0}mouse.x=(mouse.screenX-n)/camera.scale+camera.x,mouse.y=(mouse.screenY-t)/camera.scale+camera.y;for(var o=0;o<mousedownFunctions.length;o++)if(mousedownFunctions[o].fn(mouse,e))return!0}}),$("canvas").on("mousemove",function(e){if(mousemoveFunctions.length>0){var n=game.renderer.width/2,t=game.renderer.height/2;mouse.screenX=e.offsetX,mouse.screenY=e.offsetY,mouse.x=(mouse.screenX-n)/camera.scale+camera.x,mouse.y=(mouse.screenY-t)/camera.scale+camera.y;for(var o=0;o<mousemoveFunctions.length;o++)if(mousemoveFunctions[o].fn(mouse,e))return!0}}),$("body").on("keydown",function(e){if(keydownFunctions.length>0)for(n=0;n<keydownFunctions.length;n++)if(t=keydownFunctions[n].fn(e))return!0;if(keyPressFunctions.length>0&&-1==pressing.indexOf(e.keyCode)){pressing.push(e.keyCode);for(var n=0;n<keyPressFunctions.length;n++){var t=keyPressFunctions[n].fn(e);if(t)return!0}}}),$("body").on("keyup",function(e){if(keyupFunctions.length>0)for(var n=0;n<keyupFunctions.length;n++)if(keyupFunctions[n].fn(e))return!0;if(keyPressFunctions.length>0){var t=pressing.indexOf(e.keyCode);-1!=t&&pressing.splice(t,1)}}),$("*").on("mouseup touchend",function(e){"touchend"==e.type&&(e.offsetX=e.pageX-e.target.offsetLeft,e.offsetY=e.pageY-e.target.offsetTop),mouse.left=!1,mouse.right=!1,mouse.middle=!1;for(var n=0;n<mouseupFunctions.length;n++)if(mouseupFunctions[n].fn(mouse,e))return!0})}function rotateAround(e,n,t){var o=e.x-n.x,a=e.y-n.y,i=Math.atan2(a,o),c=Math.sqrt(o*o+a*a);return{x:n.x+c*Math.cos(i+t),y:n.y+c*Math.sin(i+t)}}function newObservable(e,n,t,o,a){return Object.defineProperty(e,"____"+n+"__",{writable:!0,enumerable:!1,configurable:!0}),n in e&&(e["____"+n+"__"]=e[n]),Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:function(){return t&&t(e["____"+n+"__"]),e["____"+n+"__"]},set:function(t){a&&a(e["____"+n+"__"],t),e["____"+n+"__"]=t,o&&o(t,e)}}),o}function unlinkObservable(e,n){if("____"+n+"__"in e){var t=e["____"+n+"__"];Object.defineProperty(e,n,{writable:!0,enumerable:!0,configurable:!0}),e[n]=t,delete e["____"+n+"__"]}}function objectsCopy(){var e={};for(var n in objects)e[n]=goBack(objects[n]);return e}function goBack(e){var n={};for(var t in e)if(-1==standartGameObjectProperties.indexOf(t)){n[t]={};try{"dontSerialize"in e[t]||(e[t].dontSerialize={}),"serializeObject"in e[t]||(e[t].serializeObject={})}catch(e){}for(var o in e[t])"string"!=typeof e[t][o]&&"boolean"!=typeof e[t][o]&&"number"!=typeof e[t][o]||"__initialized"==o||1==e[t].dontSerialize[o]||-1!=dontInitializeThese.indexOf(o)?1==e[t].serializeObject[o]&&(n[t][o]=e[t][o]):n[t][o]=e[t][o]}return n}function drawOnImage(e,n,t,o,a){new Date;var i=resources[e].data,c=resources[n].data;var s=0;s=o<0?Math.min(i.width,c.width+o):Math.min(i.width-o,c.width);var u=0;u=o<0?Math.min(i.height,c.height+a):Math.min(i.height-a,c.height);var r=$(".cnDummy")[0],m=r.getContext("2d");r.width=i.width,r.height=i.height;var f=o<0?0:o,g=a<0?0:a;m.drawImage(c,o,a,c.width,c.height);var l=m.getImageData(f,g,s,u);m.clearRect(0,0,r.width,r.height),m.drawImage(i,0,0,i.width,i.height);for(var d=m.getImageData(f,g,s,u),p=0;p<d.data.length;p++)0!=d.data[p+3]&&l.data[p+3]>100&&(d.data[p]=l.data[p],d.data[p+1]=l.data[p+1],d.data[p+2]=l.data[p+2]);m.putImageData(d,f,g);for(var v=r.toDataURL(),p=0,F=e;void 0!=resources[F];)F=e+ ++p;return PIXI.loader.add(F,v),PIXI.loader.load(function(e,n){for(var o in n)o==F&&(resources[o]=n[o],t(o))}),F}var clicked=!1,standartGameObjectProperties=["remove","addComponent","removeComponent","children"],mouse={x:0,y:0,screenX:0,screenY:0,left:!1,middle:!1,right:!1},actionFunctions={},clickFunctions=new Array,mousedownFunctions=new Array,mouseupFunctions=new Array,mousemoveFunctions=new Array,keydownFunctions=new Array,keyPressFunctions=new Array,keyupFunctions=new Array,dragStartFunctions=new Array,dragStopFunctions=new Array,dragFunctions=new Array,inspectFunctions=new Array,mousewheelFunctions=new Array,sceneChangeFunctions=new Array,constantGameObjects=new Array,pressing=new Array,actionFunctionArrayArray=[clickFunctions,mousedownFunctions,mouseupFunctions,mousemoveFunctions,dragStartFunctions,dragStopFunctions,dragFunctions,mousewheelFunctions];$(function(){$("<canvas style='display:none' class='cnDummy'/>").appendTo("body")});var objects={},imageFormats=["BMP","GIF","IMG","JBG","JPE","JPEG","JPG","PNG","RAS","TGA","TIFF","SVG"],soundFormats=["WAV","MP3","OGG"],isImage=function(e){for(var n in imageFormats)if(e.toUpperCase().endsWith(imageFormats[n]))return!0},isSound=function(e){for(var n in soundFormats)if(e.toUpperCase().endsWith(soundFormats[n]))return!0};void 0==String.prototype.endsWith&&(String.prototype.endsWith=function(e){return this.length-this.indexOf(e)==e.length}),void 0==String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0==this.indexOf(e)});