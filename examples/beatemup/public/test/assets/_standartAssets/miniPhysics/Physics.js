function RectangleRectangleCollision(t,i,s,h,a,e,o,l){if(!(t+s<a-o||t-s>a+o||i+h<e-l||i-h>e+l))return!0}function CircleRectangleCollision(t,i,s,h,a,e,o){var l=Math.atan2(-i+a,-t+h),c=t+s*Math.cos(l),n=i+s*Math.sin(l);if(c>h-e&&c<h+e&&n>a-o&&n<a+o){var g=Math.abs(c-h+e),y=Math.abs(c-h-e),r=Math.abs(n-a+o),v=Math.abs(n-a-o);return g<y&&g<r&&g<v?0:y<r&&y<v?1:r<v?2:3}return-1}var gravity=1;gm.Physics=function(){this.maxvy=500,this.vx=0,this.vy=0,this.static=!1,this.collidesWith="wall",this.onCollision={default:function(){}},this.grounded=!1,this.wall=void 0,this.lastPosition={x:0,y:0},this.walllastPosition={x:0,y:0},this.walls=void 0,this.actualWidth=-1,this.actualHeight=-1,this.xOffset=0,this.yOffset=0,this.gravityFactor=1},gm.Physics.prototype.create=function(){this.sleeping=!1,this.lastPosition={x:this.gameObject.position.x,y:this.gameObject.position.y}},gm.Physics.prototype.calcVy=function(t){var i=this.gameObject.position.y+this.vy*t/1e3;if(0==this.vy||this.checkWalls(this.gameObject.position.x,i)){if(this.vy>t*gravity)return this.vy=Math.max(t*gravity,this.vy/2),void this.calcVy(t);this.vy=0,!this.sleeping&&this.wall&&this.wall.y>this.gameObject.position.y&&(this.sleeping=!0,this.lastPosition={x:this.gameObject.position.x,y:this.gameObject.position.y},this.walllastPosition={x:this.wall.x,y:this.wall.y}),this.grounded=!0}else this.gameObject.position.y=i,this.grounded=!1},gm.Physics.prototype.update=function(t){new Date;if(this.sleeping&&(this.lastPosition.x!=this.gameObject.position.x||this.lastPosition.y!=this.gameObject.position.y||this.walllastPosition.x!=this.wall.x||this.walllastPosition.y!=this.wall.y||this.wall&&this.wall.gameObject&&this.wall.gameObject.name&&this.wall.gameObject.name.value&&void 0==objects[this.wall.gameObject.name.value])&&(this.sleeping=!1),!this.static){this.vy<this.maxvy&&!this.sleeping&&0!=this.gravityFactor&&(this.vy+=t*gravity*this.gravityFactor);var i=this.gameObject.position.x+this.vx*t/1e3;0!=this.vx&&(this.checkWalls(i,this.gameObject.position.y)?this.vx=0:this.gameObject.position.x=i),this.calcVy(t)}for(var s in this.onCollision){var h=getByTagName(s);if(h)for(var a=(-1==this.actualWidth?this.gameObject.position.width:this.actualWidth)/2,e=(-1==this.actualHeight?this.gameObject.position.height:this.actualHeight)/2,o=0;o<h.length;o++){var l=h[o].position,c=0,n=0;h[o].Physics&&(c=h[o].Physics.xOffset,n=h[o].Physics.yOffset);var g=(void 0==h[o].Physics||-1==h[o].Physics.actualWidth?h[o].position.width:h[o].Physics.actualWidth)/2,y=(void 0==h[o].Physics||-1==h[o].Physics.actualHeight?h[o].position.height:h[o].Physics.actualHeight)/2;RectangleRectangleCollision(this.gameObject.position.getX()+this.xOffset,this.gameObject.position.getY()+this.yOffset,a,e,l.getX()+c,l.getY()+n,g,y)&&this.onCollision[s](l.gameObject,this.gameObject)}}new Date},gm.Physics.prototype.checkWalls=function(t,i,s){if(this.collidesWith){this.walls=getByTagsName(this.collidesWith.split(",")),s=this.walls;for(var h=(-1==this.actualWidth?this.gameObject.position.width:this.actualWidth)/2,a=(-1==this.actualHeight?this.gameObject.position.height:this.actualHeight)/2,e=0;e<s.length;e++){var o=s[e].position,l=0,c=0;s[e].Physics&&(l=s[e].Physics.xOffset,c=s[e].Physics.yOffset);var n=(void 0==s[e].Physics||-1==s[e].Physics.actualWidth?s[e].position.width:s[e].Physics.actualWidth)/2,g=(void 0==s[e].Physics||-1==s[e].Physics.actualHeight?s[e].position.height:s[e].Physics.actualHeight)/2;if(RectangleRectangleCollision(t+this.xOffset,i+this.yOffset,h,a,o.x+l,o.y+c,n,g))return this.wall=o,!0}return!1}},gm.Physics.prototype.dispose=function(){};